---
title: BannerViewPageræºç å‰–æ(äºŒ)
date:  2019-09-08 15:06:16
index_img: https://gitee.com/zhpanvip/images/raw/master/blog/img/bvp.png
categories:
- BVP
tags: [è‡ªå®šä¹‰View,BVP]
---

BannerViewPagerç³»åˆ—æ–‡ç« å…±ä¸‰ç¯‡ï¼Œæ­¤æ–‡ä¸ºç¬¬äºŒç¯‡ï¼Œå¦å¤–ä¸¤ç¯‡å‚çœ‹ä¸‹é¢é“¾æ¥ï¼š

[ã€Šæ‰“é€ ä¸€ä¸ªä¸æ»‘èˆ¬è‡ªåŠ¨è½®æ’­æ— é™å¾ªç¯Androidåº“ã€‹](https://blog.csdn.net/qq_20521573/article/details/100186077)

[ã€Šå‰–æBannerViewPagerä¸­Indicatorçš„è®¾è®¡æ€æƒ³ã€‹](https://blog.csdn.net/qq_20521573/article/details/103216593)




ä¸Šç¯‡æ–‡ç« [ã€Šæ‰“é€ ä¸€ä¸ªä¸æ»‘èˆ¬è‡ªåŠ¨è½®æ’­æ— é™å¾ªç¯Androidåº“ã€‹](https://juejin.im/post/5d6bce24f265da03db0790d1)éå¸¸è¯¦ç»†çš„ä»‹ç»äº†[BannerViewPager](https://github.com/zhpanvip/BannerViewPager)çš„åŸºç¡€åŠŸèƒ½åŠä½¿ç”¨æ–¹æ³•ã€‚æˆ‘ä»¬çŸ¥é“BannerViewPagerä¸ä½†å¯ä»¥æ”¯æŒä»»æ„çš„é¡µé¢å¸ƒå±€ï¼Œè€Œä¸”å¯ä»¥æ”¯æŒä»»æ„çš„Indicatorã€‚é‚£ä¹ˆ[BannerViewPager](https://github.com/zhpanvip/BannerViewPager)çš„è¿™äº›åŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿæœ¬ç¯‡æ–‡ç« å°†æ·±å…¥æºç æ¥å¸¦å¤§å®¶äº†è§£[BannerViewPager](https://github.com/zhpanvip/BannerViewPager)çš„è®¾è®¡æ€è·¯ã€‚

# ä¸€ã€å¦‚ä½•æ”¯æŒä»»æ„çš„Itemå¸ƒå±€

äº§å“çš„éœ€æ±‚åƒå˜ä¸‡åŒ–ï¼Œä½ æ°¸è¿œä¹ŸçŒœä¸åˆ°ä¸‹ä¸€æ­¥äº§å“ä¼šç»™ä½ æä¸€ä¸ªä»€ä¹ˆæ ·çš„éœ€æ±‚ã€‚å› æ­¤å¯¹äºä¸€ä¸ªæ¯”è¾ƒäººæ€§åŒ–çš„Banneråº“æ¥è¯´ï¼Œå®ƒä¹Ÿåº”è¯¥æ”¯æŒå¼€å‘è€…å»è‡ªå®šä¹‰ä»»æ„çš„Itemé¡µé¢å¸ƒå±€ã€‚BannerViewPagerå°±æ˜¯æœ¬ç€è¿™æ ·çš„æ€è·¯æ¥åšçš„ã€‚æ¥ä¸‹æ¥å°†é€šè¿‡ä¸¤å°èŠ‚çš„å†…å®¹æ¥æ¢ç©¶BannerViewPageræ˜¯å¦‚ä½•å®ç°ä»»æ„Itemå¸ƒå±€çš„ã€‚

## 1.BannerViewPagerçš„ViewHolder
æˆ‘ä»¬å…ˆä»setHolderCreator(HolderCreator<VH> holderCreator)è¿™ä¸ªæ–¹æ³•è¯´èµ·ã€‚åœ¨ä½¿ç”¨BannerViewPagerçš„æ—¶å€™å¿…é¡»è®¾ç½®ä¸€ä¸ªHolderCreatorï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
bannerViewPager.setHolderCreator(new HolderCreator<CustomPageViewHolder>() {
                    @Override
                    public CustomPageViewHolder createViewHolder() {
                        return new CustomPageViewHolder();
                    }
                })
```
åœ¨HolderCreatorçš„createViewHolderæ–¹æ³•ä¸­è¿”å›äº†ä¸€ä¸ªCustomPageViewHolderï¼Œè¿™ä¸ªCustomPageViewHolderæ˜¯æˆ‘ä»¬è‡ªå·±å®ç°çš„ã€‚å…¶å†…éƒ¨ä¼šé€šè¿‡createViewæ–¹æ³•æ¥inflateå‡ºæ¥ä¸€è‡ªå®šä¹‰çš„itemView,å¹¶åœ¨onBindæ–¹æ³•ä¸­ä¸ºitemViewç»‘å®šæ•°æ®ã€‚ç å¦‚ä¸‹ï¼š

```java
public class CustomPageViewHolder implements ViewHolder<CustomBean> {
    private ImageView mImageView;
    private TextView mTextView;
    @Override
    public View createView(ViewGroup viewGroup, Context context, int position) {
        View view = LayoutInflater.from(context).inflate(R.layout.item_custom_view, viewGroup, false);
        mImageView = view.findViewById(R.id.banner_image);
        mTextView = view.findViewById(R.id.tv_describe);
        return view;
    }

    @Override
    public void onBind(Context context, CustomBean data, int position, int size) {
        mImageView.setImageResource(data.getImageRes());
        mTextView.setText(data.getImageDescription());
    }
    ...
}
```
åœ¨BannerViewPagerå†…éƒ¨setupViewPagerçš„æ—¶å€™ï¼Œé’ˆå¯¹HolderCreatoråšäº†å¦‚ä¸‹æ“ä½œï¼š

```java
	 private void setupViewPager() {
	        if (holderCreator != null) {
	             BannerPagerAdapter<T, VH> bannerPagerAdapter =
                    new BannerPagerAdapter<>(mList, holderCreator);
           		 bannerPagerAdapter.setPageStyle(mPageStyle);
           		 bannerPagerAdapter.setCanLoop(isCanLoop);
         		 bannerPagerAdapter.setPageClickListener(position -> {
	                if (mOnPageClickListener != null) {
	                    mOnPageClickListener.onPageClick(PositionUtils.getRealPosition(isCanLoop, position, mList.size(), mPageStyle));
                	}
            });
            mViewPager.setAdapter(bannerPagerAdapter);
	        		...
	        } else {
	            throw new NullPointerException("You must set HolderCreator for BannerViewPager");
	        }
	    }
```
ä¸Šè¿°ä»£ç ä¸­åˆ¤æ–­å¦‚æœholderCreatorä¸ºnullæ—¶å°±æŠ›å‡ºäº†ä¸€ä¸ªNullPointerExceptionï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆå¿…é¡»è¦ä¸ºBannenrViewPagerè®¾ç½®holderCreatorã€‚å½“holderCreatorä¸ä¸ºnullæ—¶ï¼Œå°†holderä¼ é€’åˆ°äº†BannerPagerAdapterä¸­,å¹¶ä¸”ä¸ºBannerPagerAdapterè®¾ç½®äº†ç›¸å…³å‚æ•°å’Œé¡µé¢ç‚¹å‡»äº‹ä»¶ã€‚

æˆ‘ä»¬æ¥ä¸‹æ¥åˆ°BannerPagerAdapterä¸­ä¸€æ¢ç©¶ç«Ÿï¼š

```java
public class BannerPagerAdapter<T, VH extends ViewHolder> extends PagerAdapter {
	 
    @Override
    public @NonNull
    Object instantiateItem(@NonNull final ViewGroup container, final int position) {
        View itemView = getView(PositionUtils.getRealPosition(isCanLoop, position, mList.size(), mPageStyle),container);
        container.addView(itemView);
        return itemView;
    }

		...
	@SuppressWarnings("unchecked")
    private View getView(final int position, ViewGroup container) {
        ViewHolder<T> holder = holderCreator.createViewHolder();
        if (holder == null) {
            throw new RuntimeException("can not return a null holder");
        }
        return createView(holder, position, container);
    }
    
	private View createView(ViewHolder<T> holder, int position, ViewGroup container) {
	        View view = null;
	        if (list != null && list.size() > 0) {
	          view = holder.createView(container, container.getContext(), position);
	          holder.onBind(container.getContext(), list.get(position), position, list.size());
	        return view;
	    }

}
```
åœ¨BannerPagerAdapterçš„getViewæ–¹æ³•ä¸­é€šè¿‡holderCreator.createViewHolder()æ‹¿åˆ°äº†è‡ªå®šä¹‰çš„ViewHolderï¼Œæ­¤æ—¶å³ä¸ºä¸Šè¾¹çš„CustomPageViewHolder ã€‚æ¥ä¸‹æ¥åœ¨createViewæ–¹æ³•ä¸­è°ƒç”¨CustomPageViewHolderçš„createViewæ–¹æ³•æ‹¿åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„itemView,å¹¶é€šè¿‡holder.onBindæ–¹æ³•å°†é›†åˆä¸­çš„æ•°æ®ä¼ é€’ç»™äº†CustomPageViewHolderã€‚åˆ°è¿™é‡Œæˆ‘ä»¬å°±å®Œæˆäº†è‡ªå®šä¹‰itemå¸ƒå±€ä»¥åŠitemæ•°æ®çš„ç»‘å®šã€‚
## 2 .BannerViewPagerçš„æ³›å‹è®¾è®¡
åœ¨ä¸Šä¸€å°èŠ‚ä¸­é€šè¿‡HolderCreatoræ¥å®ç°ä»»æ„çš„é¡µé¢å¸ƒå±€ï¼Œä½†æ­¤æ—¶æˆ‘ä»¬åº”è¯¥ä¼šé¢ä¸´ä¸€ä¸ªé—®é¢˜ï¼Œæ—¢ç„¶å¯ä»¥æ”¯æŒä»»æ„çš„é¡µé¢å¸ƒå±€é‚£ä¹ˆBannerViewPagerä¸­æ¥æ”¶çš„æ•°æ®ä¹Ÿåº”è¯¥æ—¶ä»»æ„ç±»å‹çš„ã€‚å¯¹äºè¯¥é—®é¢˜æˆ‘ä»¬å¯ä»¥å¼•å…¥æ³›å‹æ¥å®ç°ã€‚é¦–å…ˆçœ‹BannerViewPagerçš„æ³›å‹ï¼š

```java
public class BannerViewPager<T, VH extends ViewHolder> extends RelativeLayout implements
        ViewPager.OnPageChangeListener {
        
	// è½®æ’­æ•°æ®é›†åˆ
        private List<T> mList;

	private HolderCreator<VH> holderCreator;
    
	//	...
}
```
BannerViewPageræœ‰ä¸¤ä¸ªæ³›å‹å‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°Tæ˜¯å¯¹åº”çš„æ•°æ®ç±»å‹ï¼Œå®ƒç”¨æ¥ä½œä¸ºBannerViewPagerä¸­Listé›†åˆçš„æ³›å‹ã€‚å¦ä¸€ä¸ªæ³›å‹å‚æ•°VHè§„å®šäº†å¿…é¡»æ˜¯ç»§æ‰¿ViewHolderçš„ç±»ï¼Œç”¨æ¥ä½œä¸ºHolderCreatorçš„æ³›å‹ã€‚è€ŒViewHolderå’ŒHolderCreatorå‡æ˜¯ä¸€ä¸ªå¸¦æœ‰æ³›å‹å‚æ•°çš„æ¥å£ï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š

```java
public interface ViewHolder<T> {
    View createView(ViewGroup viewGroup,Context context, int position);
    
    /**
     * @param context context
     * @param data å®ä½“ç±»å¯¹è±¡
     * @param position å½“å‰ä½ç½®
     * @param size é¡µé¢ä¸ªæ•°
     */
    void onBind(Context context,T data,int position,int size);
}

public interface HolderCreator<VH extends ViewHolder> {
    /**
     * åˆ›å»ºViewHolder
     */
    VH createViewHolder();
}
```
å¦å¤–ï¼ŒTå’ŒVHä¸¤ä¸ªæ³›å‹ä¹ŸåŒæ—¶ä½œä¸ºBannerPagerAdapterçš„æ³›å‹å‚æ•°ï¼š

```java
public class BannerPagerAdapter<T, VH extends ViewHolder> extends PagerAdapter {

	private List<T> list;
	 
	public BannerPagerAdapter(List<T> list, HolderCreator<VH> holderCreator) {
	        this.list = list;
	        this.holderCreator = holderCreator;
	    }

}
```
å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬é€šè¿‡æ³›å‹çº¦æŸï¼Œä½¿å¾—æ¶‰åŠåˆ°çš„ç›¸å…³ç±»ä¸­çš„å‚æ•°æ•°æ®ç±»å‹ä¿æŒäº†åŒæ­¥,ä»è€Œå®ç°äº†BannerViewPagerå¯ä»¥æ¥æ”¶å¹¶å¤„ç†ä»»æ„çš„æ•°æ®ç±»å‹ã€‚

# äºŒã€å¦‚ä½•å®ç°æ— é™å¾ªç¯è½®æ’­

å…³äºViewPagerçš„æ— é™å¾ªç¯æ— å¤–ä¹ä¸¤ç§æ–¹æ¡ˆã€‚

ç¬¬ä¸€ç§æ–¹æ¡ˆæ˜¯åœ¨PagerAdapterçš„getCountä¸­è¿”å›ä¸€ä¸ªInteger.MAX_VALUEï¼Œå³ä¸€ä¸ªæœ€å¤§çš„Integeræ•´æ•°ã€‚ç„¶åå°†setCurrentItemçš„å€¼è®¾ç½®ä¸º Integer.MAX_VALUE / 2ï¼Œåœ¨æ»‘åŠ¨è¿‡ç¨‹ä¸­ä¸æ–­å–ä½™ä»¥æ­¤æ¥è¾¾åˆ°ä¸€ä¸ªæ— é™å¾ªç¯è½®æ’­çš„å‡è±¡ã€‚

å¦å¤–ä¸€ç§æ–¹æ¡ˆæ˜¯é¢å¤–å¢åŠ ä¸¤ä¸ªViewPagerçš„item countï¼Œç„¶ååœ¨ç¬¬0ä¸ªItemå¡«å……æœ€åä¸€æ¡æ•°æ®ï¼Œåœ¨æœ€åä¸€ä¸ªItemå¡«å……ç¬¬0æ¡æ•°æ®ã€‚å½“å³æ»‘åˆ°ç¬¬ä¸€ä¸ªItemçš„æ—¶å€™å°†currentItemç½®ä¸ºpageSize-1,å½“æ»‘åŠ¨åˆ°æœ€åä¸€ä¸ªItemçš„æ—¶å€™å°†currentItemç½®ä¸º1ï¼Œä»¥æ­¤æ¥è¾¾åˆ°ä¸€ä¸ªæ— é™å¾ªç¯çš„ç›®çš„ï¼Œæ­¤æ–¹æ¡ˆçš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š

![æ— é™å¾ªç¯ç¤ºæ„å›¾](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS8xMS8xNy8xNmU3ODVhZDcyYmQ2NzQz?x-oss-process=image/format,png)
BannerViewPagerçš„æ— é™è½®æ’­ä½¿ç”¨çš„æ˜¯ç¬¬äºŒç§æ–¹æ¡ˆã€‚è‡³äºè¿™ä¸¤ç§æ–¹æ¡ˆå­°ä¼˜å­°åŠ£ä¸å¥½åˆ¤æ–­ï¼Œå› ä¸ºæˆ‘å¹¶æ²¡æœ‰æ·±å…¥ç ”ç©¶è¿‡æ–¹æ¡ˆä¸€ï¼Œå› æ­¤å¯¹æ¯”è¿™ä¸¤ç§æ–¹æ¡ˆçš„ä¼˜ç•¥å¯¹æ¯”æˆ‘æš‚æ—¶æ²¡æœ‰å‘è¨€æƒã€‚ä½†æ˜¯å…³äºç¬¬äºŒç§æ–¹æ¡ˆçš„ä¼˜ç•¥æˆ‘å¯ä»¥åŠ ä»¥åˆ†æã€‚

## æ–¹æ¡ˆäºŒçš„ä¼˜ç‚¹ï¼š
**1.è¿™ä¸€æ–¹æ¡ˆå®ç°äº†çœŸæ­£æ„ä¹‰ä¸Šçš„æ— é™è½®æ’­**

ç›¸æ¯”æ–¹æ¡ˆä¸€è®¾ç½®äº†ä¸€ä¸ªæœ€å¤§å€¼æ¥åˆ¶é€ æ— é™è½®æ’­çš„å‡è±¡ï¼Œæ–¹æ¡ˆäºŒå®ç°çš„æ˜¯ä¸€ç§çœŸæ­£çš„æ— é™è½®æ’­ã€‚è¿™ä¸ªæ–¹æ¡ˆé€šè¿‡æ‰‹åŠ¨åˆ‡æ¢positionä½¿å¾—è½®æ’­èƒ½å¤Ÿæ— é™æŒç»­ä¸‹å»ã€‚è¿™ä¸€ç‚¹å¯èƒ½è¦ç•¥ä¼˜äºæ–¹æ¡ˆä¸€ã€‚ï¼ˆå…¶å®Integer.MAX_VALUEçš„æ•°å€¼å·²ç»è¾¾åˆ°äº†æ•°åäº¿çº§åˆ«ï¼Œå³ä½¿ä»ä¸€æ•°åˆ°åäº¿ææ€•éƒ½è¦å‡ å¤©å§ï¼Ÿæ‰€ä»¥è¿™ä¸€ç‚¹ä¹Ÿç®—ä¸ä¸Šæ–¹æ¡ˆä¸€çš„ç¼ºç‚¹ï¼‰

**2.é¡µé¢åˆ‡æ¢è¾ƒå°‘å‡ºç°ç©ºç™½é¡µ**

æ›¾ç»çœ‹è¿‡å‡ ä¸ªä½¿ç”¨æ–¹æ¡ˆä¸€å®ç°çš„Banneréƒ½æœ‰å¶å°”å‡ºç°ç©ºç™½é¡µçš„é—®é¢˜ï¼Œå½“ç„¶ä¸æ’é™¤æ˜¯è¿™äº›åº“å†™çš„æœ‰é—®é¢˜ï¼Œæ¯•ç«Ÿæˆ‘ä¹Ÿè§è¿‡ä½¿ç”¨æ–¹æ¡ˆä¸€å®ç°éå¸¸å¥½çš„åº“ã€‚è€ŒBannerViewPageråœ¨ä½¿ç”¨æ–¹æ¡ˆäºŒæ—¶å¹¶æ²¡æœ‰ç»è¿‡ä»€ä¹ˆç‰¹æ®Šå¤„ç†ï¼Œå´ä¹Ÿå¾ˆå°‘è§åˆ°ç©ºç™½é¡µé—®é¢˜ï¼Œå½“ç„¶ä¹Ÿä¸æ’é™¤æ˜¯æˆ‘ä»£ç å†™çš„å¥½ã€‚ï¼ˆæ¿å„¿ç –å°½ç®¡æ‰”è¿‡æ¥å§ï¼Œå“ˆå“ˆï¼ï¼‰ã€‚

## æ–¹æ¡ˆäºŒçš„ç¼ºç‚¹ï¼š
è™½ç„¶BannerViewPagerä½¿ç”¨çš„æ˜¯æ–¹æ¡ˆäºŒï¼Œä½†æ˜¯ç§‰ç€å…¬æ­£çš„æ€åº¦ï¼Œç»ä¸åŒ…åº‡è¿™ä¸€æ–¹æ¡ˆçš„ç¼ºç‚¹ã€‚è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜ç‚¹è™½ç„¶æˆ‘è‹¦æ€å†¥æƒ³ä¹Ÿåªæƒ³å‡ºæ¥äº†ä¸¤æ¡ï¼Œä½†æ˜¯å…³äºå®ƒçš„ç¼ºç‚¹æˆ‘å´èƒ½ç½—åˆ—å‡ºæ¥å¾ˆå¤šã€‚æ­£æ‰€è°“è°(sei)ç”¨è°(sei)çŸ¥é“ï¼

**1.onPageSelected(int)æ–¹æ³•é‡å¤è°ƒç”¨é—®é¢˜**

æˆ‘ä»¬ä¸ºBannerViewPagerå¼€å¯è‡ªåŠ¨è½®æ’­ï¼Œå¹¶ä¸ºå…¶è®¾ç½®é¡µé¢æ”¹å˜çš„ç›‘å¬äº‹ä»¶ï¼Œå¦‚ä¸‹ï¼š
```java
 mBannerViewPager.setAutoPlay(true)
 			.setOnPageChangeListener(new OnPageChangeListenerAdapter() {
                    @Override
                    public void onPageSelected(int position) {
                        BannerUtils.e("position " + position);
                    }
                })
```
ç„¶åå¯ä»¥çœ‹åˆ°æ‰“å°çš„Logï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS8xMS8xNy8xNmU3ODVhZDcyZThkZDZm?x-oss-process=image/format,png)
åœ¨BannerViewPageråªæœ‰ä¸‰ä¸ªé¡µé¢çš„æƒ…å†µä¸‹ï¼Œé¡µé¢position selectedçš„å‘¨æœŸæ˜¯0ã€1ã€2ã€0ã€‚å¾ˆæ˜æ˜¾ï¼Œç¬¬0ä¸ªé¡µé¢è¢«å¤šè°ƒç”¨äº†ä¸€æ¬¡ã€‚è™½ç„¶åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¹¶æ²¡æœ‰å½±å“ï¼Œä½†æ˜¯å½“éœ€è¦åœ¨é€‰ä¸­ç¬¬0ä¸ªé¡µé¢æ—¶åšä¸€äº›é€»è¾‘çš„è¯ï¼Œå°±ä¼šäº§ç”Ÿä¸€å®šå½±å“ã€‚è‡³äºè¿™ä¸ªé—®é¢˜æœ‰æ²¡æœ‰è§£å†³åŠæ³•ï¼Œæš‚æ—¶è¿˜æœªå»åšè¿›ä¸€æ­¥æ¢ç©¶ã€‚

**2.åœ¨ä¸€å±ä¸‰é¡µæ¨¡å¼ä¸‹ï¼Œè¿™ä¸€æ–¹æ¡ˆåœ¨è½®æ’­åˆ°æœ€åä¸€é¡µæ—¶ä¼šå‡ºç°ä¸‹ä¸€é¡µçŸ­æš‚ç©ºç™½çš„é—®é¢˜**

å‡ºç°è¿™ä¸€é—®é¢˜çš„åŸå› æ˜¯å› ä¸ºä¸ºäº†å®Œæˆå¾ªç¯åœ¨åˆ‡æ¢åˆ°æœ€åä¸€é¡µæ—¶æˆ‘ä»¬ç«‹å³å°†positionåˆ‡æ¢åˆ°äº†positionä¸º1çš„é¡µé¢ï¼Œè€Œæ­¤æ—¶positionä¸º2ä¸ªé¡µé¢è¿˜æœªåŠ è½½å‡ºæ¥ï¼Œå› æ­¤å°±æœ‰äº†çŸ­æš‚çš„ç©ºç™½é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œåˆä¸å¾—ä¸åœ¨åŸæ¥å¾ªç¯çš„åŸºç¡€ä¸Šå†å¢åŠ ä¸¤ä¸ªé¡µé¢ï¼Œå¹¶å°†setOffscreenPageLimitè®¾ç½®ä¸º2ã€‚è¿™æ ·æ— å½¢ä¸­å¢åŠ äº†å†…å­˜å¼€é”€ï¼Œå¹¶ä¸”ä½¿å¾—é€»è¾‘å¤„ç†å˜å¾—æ›´ä¸ºå¤æ‚ï¼

**3.éœ€è¦å¯¹positionè¿›è¡Œå˜æ¢**

ä¸ºäº†å®ç°å¾ªç¯æˆ‘ä»¬å°†page countå¢åŠ äº†2ï¼Œä¸ºäº†è§£å†³ä¸€å±ä¸‰é¡µçš„ç©ºç™½é—®é¢˜æˆ‘ä»¬å°†page countå¢åŠ äº†4ã€‚ä½†å¯¹å¤–æš´éœ²çš„æ¥å£éœ€è¦æ‹¿åˆ°æ­£ç¡®çš„positionï¼Œæ­¤æ—¶æˆ‘ä»¬å°±ä¸å¾—ä¸åœ¨BannerViewPagerå†…éƒ¨å¯¹positionè¿›è¡Œå˜æ¢ï¼Œä½¿ä¹‹èƒ½å¤Ÿå¯¹åº”åˆ°æ­£ç¡®çš„positionã€‚è™½ç„¶è§£å†³äº†é—®é¢˜ï¼Œä½†æ˜¯è¿™äº›é€»è¾‘å¤„ç†å´å˜å¾—å¾ˆè‡ƒè‚¿ã€‚å°½ç®¡æ–¹æ¡ˆä¸€ä¹Ÿä¼šå­˜åœ¨positionçš„å˜æ¢é—®é¢˜ï¼Œä½†æ˜¯ç›¸æ¯”æ–¹æ¡ˆäºŒè¿˜æ˜¯ä¼˜é›…å¾ˆå¤šã€‚

ç»¼ä¸Šæ¥çœ‹ï¼Œæ–¹æ¡ˆäºŒå…¶å®å¹¶ä¸æ˜¯ä¸€ä¸ªå®Œç¾çš„æ–¹æ¡ˆï¼Œç›¸åå®ƒå´å­˜åœ¨è¯¸å¤šçš„é—®é¢˜ï¼ä½†æ˜¯ç”±äºæ²¡æœ‰ç”¨è¿‡æ–¹æ¡ˆä¸€ï¼Œæ‰€ä»¥å¯¹äºæ–¹æ¡ˆä¸€æœ‰æ²¡æœ‰å‘ï¼Œç°åœ¨ä¹Ÿä¸å¥½å¦„ä¸‹ç»“è®ºã€‚æœ‰ç†Ÿæ‚‰æ–¹æ¡ˆä¸€çš„åŒå­¦å¯ä»¥åœ¨æ–‡ç« ä¸‹ç•™è¨€å‘ŠçŸ¥ã€‚åç»­æˆ‘ä¼šå•ç‹¬å¼€ä¸€ä¸ªåˆ†æ”¯æ¥å°è¯•ä¸‹æ–¹æ¡ˆä¸€ã€‚å¦‚æœæ–¹æ¡ˆä¸€æ²¡æœ‰å¤§é—®é¢˜ï¼ŒBannerViewPagerçš„å¾ªç¯è½®æ’­æ–¹æ¡ˆå¯èƒ½ä¼šè¿ç§»åˆ°ç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼ˆç›®å‰2.4.3ç‰ˆæœ¬å·²åˆ‡æ¢ä¸ºæ–¹æ¡ˆä¸€ï¼Œè®¸å¤šé—®é¢˜è¿åˆƒè€Œè§£ã€‚çœŸé¦™ï¼ï¼‰ã€‚


# ä¸‰ã€åƒå˜ä¸‡åŒ–çš„Indicator
åœ¨æœ€åˆçš„è®¾è®¡ä¸­ï¼ŒBannerViewPageråŒå…¶å®ƒå¤§å¤šBannenråº“ä¸€æ ·,å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªIndicatorçš„Listé›†åˆç”¨æ¥å­˜æ”¾Indicatorçš„iconï¼Œç„¶åæ ¹æ®é¡µé¢sizeåŠ¨æ€çš„æ·»åŠ Indicatorã€‚æ˜¾ç„¶è¿™æ ·çš„Indicatoréå¸¸ä¸çµæ´»ï¼Œå¦‚æœUIè§‰å¾—ä¹‹å‰é¢œè‰²ä¸å¥½çœ‹ï¼Œéœ€è¦æ¢ä¸ªé¢œè‰²ã€‚ä½ è¯´ï¼ŒOKï¼æ²¡å…³ç³»ï¼Œä½ ç»™æˆ‘åˆ‡å›¾å°±å¥½äº†ã€‚ä½†æ˜¯å¦‚æœUIè¯´æˆ‘éœ€è¦ä¸€ä¸ªIndicatorè·ŸéšViewPageræ»‘åŠ¨çš„æ•ˆæœï¼Œé‚£ä¹ˆæ­¤æ—¶ä½ ä¸€å®šä¸€è„¸èŒ«ç„¶ä¸çŸ¥æ‰€æªï¼äºæ˜¯å’ŒUIå¼€å¯äº†æ¼«é•¿çš„æ‹‰é”¯æˆ˜...æ‰¯è¿œäº†ï¼Œæˆ‘ä»¬ç»§ç»­å›å½’æ­£é¢˜ã€‚è€ƒè™‘åˆ°è¿™ä¸ªé—®é¢˜ï¼Œåœ¨åæ¥çš„ç‰ˆæœ¬ä¸­é’ˆå¯¹Indicatorè¿›è¡Œäº†ä¼˜åŒ–é‡æ„ï¼Œç°åœ¨çš„BannerViewPagerå·²ç»å¯ä»¥æ”¯æŒä»»æ„æ ·å¼çš„Indicatorã€‚å¹¶ä¸”è¿˜å¯ä»¥æ ¹æ®éœ€æ±‚ä»»æ„æ‘†æ”¾Indicatorçš„ä½ç½®ã€‚æ˜¯å¦æœŸå¾…äº†è§£è¿™äº›ç¥å¥‡çš„åŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿæ¥ä¸‹æ¥å°±ä¸€èµ·æ¥æ¢ç©¶
é¦–å…ˆï¼Œå®šä¹‰äº†ä¸€ä¸ªIIndicatorçš„æ¥å£ï¼Œè¯¥æ¥å£ç»§æ‰¿äº†ViewPager.OnPageChangeListeneræ¥å£ã€‚å…¶ä»£ç å¦‚ä¸‹ï¼š

```java
public interface IIndicator extends ViewPager.OnPageChangeListener {
    void setPageSize(int pageSize);

    void setNormalColor(int normalColor);

    void setCheckedColor(int checkedColor);

    void setSlideMode(IndicatorSlideMode slideStyle);

    void setIndicatorGap(int gap);

    void setIndicatorWidth(int normalIndicatorWidth, int checkedIndicatorWidth);

    void notifyDataChanged();
}

```
åœ¨BannerViewPagerå†…éƒ¨æŒæœ‰äº†IIndicatorçš„å®ä¾‹ï¼Œå¹¶ä¸”setIndicatorViewæ–¹æ³•åªæ¥æ”¶IIndicatorç±»å‹çš„å‚æ•°ã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
public class BannerPagerAdapter<T, VH extends ViewHolder> extends PagerAdapter {
	
		// è½®æ’­æŒ‡ç¤ºå™¨
	    private IIndicator mIndicatorView;

		/**
	     * è®¾ç½®è‡ªå®šä¹‰ViewæŒ‡ç¤ºå™¨,è‡ªå®šä¹‰Viewéœ€è¦éœ€è¦ç»§æ‰¿BaseIndicatoræˆ–è€…å®ç°IIndicatoræ¥å£è‡ªè¡Œç»˜åˆ¶æŒ‡ç¤ºå™¨ã€‚
	     * æ³¨æ„ï¼Œä¸€æ—¦è®¾ç½®äº†è‡ªå®šä¹‰IndicatorView,é€šè¿‡BannerViewPagerè®¾ç½®çš„éƒ¨åˆ†IndicatorViewå‚æ•°å°†å¤±æ•ˆã€‚
	     *
	     * @param customIndicator è‡ªå®šä¹‰æŒ‡ç¤ºå™¨
	     */
	    public BannerViewPager<T, VH> setIndicatorView(IIndicator customIndicator) {
	        if (customIndicator instanceof View) {
	            isCustomIndicator = true;
	            mIndicatorView = customIndicator;
	        }
	        return this;
	    }
}
```
åœ¨setIndicatorViewå†…éƒ¨é€šè¿‡åˆ¤æ–­customIndicatoræ˜¯å¦æ˜¯Viewçš„å®ä¾‹ï¼Œä»¥æ­¤ç¡®ä¿äº†æŒ‡ç¤ºå™¨å¿…é¡»ç»§æ‰¿è‡ªViewå¹¶å®ç°IIndicatoræ¥å£ã€‚å¹¶ä¸”å¯ä»¥çœ‹åˆ°åœ¨æ»¡è¶³æ¡ä»¶çš„æƒ…å†µä¸‹å°†isCustomIndicatorç½®ä¸ºäº†trueï¼Œä»¥æ­¤æ¥æ ‡è®°æ˜¯å¦æ˜¯è‡ªå®šä¹‰çš„æŒ‡ç¤ºå™¨ã€‚å¦‚æœå¤–éƒ¨æ²¡æœ‰è°ƒç”¨setIndicatorViewè®¾ç½®è‡ªå®šä¹‰æŒ‡ç¤ºå™¨æˆ–è€…è®¾ç½®çš„æŒ‡ç¤ºå™¨ä¸ç¬¦åˆè¦æ±‚ï¼Œé‚£ä¹ˆmIndicatorViewå²‚ä¸æ˜¯å°±ä¸ºnulläº†ï¼Ÿä¸æ…Œï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ä»£ç ï¼š

```java
public class BannerPagerAdapter<T, VH extends ViewHolder> extends PagerAdapter {
   /**
     * æ„é€ ViewPager
     *
     * @param list ViewPageræ•°æ®
     */
    public void create(List<T> list) {
        initBannerData(list);
    }

	private void initBannerData(List<T> list) {
	        if (list != null) {
	            mList.clear();
	            mList.addAll(list);
	            if (mList.size() > 0) {
	                if (mList.size() > 1) {
	                    if (isCustomIndicator && null != mIndicatorView) {
	                        initIndicator(mIndicatorView);
	                    } else {
	                        initIndicator(IndicatorFactory.createIndicatorView(getContext(), mIndicatorStyle));
	                    }
	                }
	                // ...
	            }
	        }
	    }
}
```
æˆ‘ä»¬åœ¨ä½¿ç”¨BannerViewPagerçš„æ—¶å€™è®¾ç½®å®Œå‚æ•°é…ç½®ä¹‹åéœ€è¦è°ƒç”¨create(List\<T\> list)æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¼šæ ¹æ®listçš„æ•°æ®æƒ…å†µæ¥åˆå§‹åŒ–Indicatorã€‚ä¸Šè¿°ä»£ç ä¸­åªæœ‰åœ¨list.size()å¤§äº1çš„æ—¶å€™æ‰ä¼šåˆå§‹åŒ–Indicatorï¼Œå¹¶ä¸”åœ¨åè¾¹åˆ¤æ–­å¦‚æœæ˜¯è‡ªå®šä¹‰çš„Indicatorå°±ç›´æ¥åˆå§‹åŒ–æŒ‡ç¤ºå™¨ï¼Œå¦‚æœæ²¡æœ‰è‡ªå®šä¹‰æŒ‡ç¤ºå™¨ï¼Œé‚£ä¹ˆå°±è°ƒç”¨æŒ‡ç¤ºå™¨å·¥å‚ï¼Œæ ¹æ®è®¾ç½®çš„æŒ‡ç¤ºå™¨Styleç”Ÿæˆå†…ç½®æŒ‡ç¤ºå™¨æ ·å¼ã€‚è¿™ä¹ˆä¸€æ¥å°±å®ç°äº†å†…ç½®æŒ‡ç¤ºå™¨å’Œè‡ªå®šä¹‰æŒ‡ç¤ºå™¨çš„åˆ‡æ¢ã€‚

é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œå…³äºIndicatorä½ç½®ä»»æ„æ‘†æ”¾æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿä¸ºä»€ä¹ˆè‡ªå®šä¹‰æŒ‡ç¤ºå™¨å¯ä»¥ç›´æ¥newå‡ºæ¥ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨xmlä¸­å‘¢ï¼Ÿå…³äºè¿™ä¸¤ä¸ªé—®é¢˜å°±éœ€è¦æ¥çœ‹ä¸‹initIndicatoråšäº†ä»€ä¹ˆæ“ä½œäº†ã€‚

```java
private void initIndicator(IIndicator indicatorView) {
        mIndicatorLayout.setVisibility(mIndicatorVisibility);
        mIndicatorView = indicatorView;
        if (((View) mIndicatorView).getParent() == null) {
            mIndicatorLayout.removeAllViews();
            mIndicatorLayout.addView((View) mIndicatorView);
            initIndicatorViewMargin();
            initIndicatorGravity();
        }
    }
```
åœ¨initIndicatorä¸­ä¼šé¦–å…ˆåˆ¤æ–­indicatorViewçš„parentæ˜¯å¦ä¸ºnullã€‚ä»€ä¹ˆæƒ…å†µä¸‹indicatorViewçš„parentä¼šä¸ºnullå‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯å†…ç½®æŒ‡ç¤ºå™¨å’ŒsetIndicatorView()çš„å‚æ•°é€šè¿‡newçš„æ–¹å¼ä¼ è¿›æ¥çš„æƒ…å†µä¸‹indicatorViewçš„parentä¼šæ˜¯nullçš„æƒ…å†µï¼é‚£ä¹ˆæ­¤æ—¶å°±å°†indicatoræ·»åŠ åˆ°BannerViewPagerå†…éƒ¨mIndicatorLayoutä¸­å°±å¯ä»¥äº†ã€‚è€Œå¦‚æœIndicatoræ˜¯å£°æ˜åœ¨xmlä¸­çš„æƒ…å†µï¼Œæ­¤æ—¶é€šè¿‡findViewByIdè·å¾—çš„Indicatorå…¶parentä¸€å®šä¸ä¼šæ˜¯nullï¼Œé‚£ä¹ˆåœ¨initIndicatorä¸­åªæ˜¯å°†å…¶èµ‹å€¼ç»™äº†mIndicatorViewã€‚ä»¥æ­¤å®Œæˆäº†å¯¹å†…ç½®IndicatorViewçš„æ›¿æ¢ã€‚è¿™æ ·å…¶å®ä¸ç®¡é€šè¿‡æ€æ ·çš„æ–¹æ³•è®¾ç½®IndicatorViewéƒ½ä¿è¯äº†BannerViewPagerå†…éƒ¨å§‹ç»ˆåªä¼šç»´æŠ¤ä¸€ä¸ªIndicatorã€‚æ–¹æ³•éå¸¸å·§å¦™ï¼Œè¿™é‡Œæˆ‘æƒ³è¦ä¸€ä¸ªèµï¼ï¼ˆä¼¼ä¹åˆå—…åˆ°äº†æ¿å„¿ç –çš„æ°”æ¯ï¼‰



# å››ã€é‡åˆ°çš„å…¶ä»–é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ
åœ¨BannerViewPagerçš„å¼€å‘è¿‡é¿å…ä¸äº†çš„ä¼šç¢°åˆ°ä¸€äº›é—®é¢˜ï¼Œè™½ç„¶æœ‰äº›å·²ç»è§£å†³äº†ï¼Œä½†æœ‰äº›å¯èƒ½è¿˜æ‚¬è€Œæœªå†³ã€‚ä½†æ˜¯ä¸ç®¡è§£å†³æ²¡è§£å†³ä»¥ä¾›å¤§å®¶å‚è€ƒæˆ–è®¨è®ºã€‚

## 1.æ‰‹æŒ‡æ»‘åŠ¨é¡µé¢è¿‡ç¨‹ä¸­åº”åœæ­¢è‡ªåŠ¨è½®æ’­

è‡ªåŠ¨è½®æ’­çš„åŠŸèƒ½æ˜¯é€šè¿‡Handleræ¥å®ç°çš„ã€‚é€šè¿‡postDelayedå¼€å¯è½®æ’­ï¼Œé€šè¿‡removeCallbacksåœæ­¢è½®æ’­ã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
/**
     * å¼€å¯è½®æ’­
     */
    public void startLoop() {
        if (!isLooping && isAutoPlay && mList.size() > 1) {
            mHandler.postDelayed(mRunnable, interval);
            isLooping = true;
        }
    }

    /**
     * åœæ­¢è½®æ’­
     */
    public void stopLoop() {
        if (isLooping) {
            mHandler.removeCallbacks(mRunnable);
            isLooping = false;
        }
    }
```
å¦‚æœåœ¨æ‰‹æŒ‡æ»‘åŠ¨çš„è¿‡ç¨‹ä¸­æ²¡æœ‰åœæ­¢è½®æ’­ï¼Œä½“éªŒä¸Šæ¥è¯´éå¸¸ä¸å¥½ã€‚å› æ­¤ï¼Œéœ€è¦å¤„ç†è¿™ç§æƒ…å†µã€‚è§£å†³æ–¹æ¡ˆæ˜¯é‡å†™ViewPagerçš„setOnTouchListeneræ–¹æ³•ï¼Œç›‘å¬æ‰‹æŒ‡æ»‘åŠ¨çš„æ—¶å€™åœæ­¢è½®æ’­ï¼ŒæŠ¬èµ·æ‰‹æŒ‡çš„æ—¶å€™å¼€å¯è½®æ’­ã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
 private void setTouchListener() {
        mViewPager.setOnTouchListener((v, event) -> {
            int action = event.getAction();
            switch (action) {
                case MotionEvent.ACTION_DOWN:
                case MotionEvent.ACTION_MOVE:
                    isLooping = true;
                    stopLoop();
                    break;
                case MotionEvent.ACTION_UP:
                case MotionEvent.ACTION_CANCEL:
                    isLooping = false;
                    startLoop();
                default:
                    break;
            }
            return false;
        });
    }
```

## 2.å…³äºinstantiateItemçš„ä¼˜åŒ–é—®é¢˜
æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ViewPageræ¯æ¬¡åˆ‡æ¢é¡µé¢çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨instantiateItemå»å®ä¾‹åŒ–ItemViewï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬åœ¨è¿™ä¸ªæ–¹æ³•ä¸­é€šè¿‡ViewHolderçš„createViewæ–¹æ³•æ¯æ¬¡åˆ‡æ¢é¡µé¢éƒ½ä¼šè¢«è°ƒç”¨é‡æ–°åˆå§‹åŒ–ç»‘å®šæ•°æ®ã€‚è¿™æ ·å¯¹ç¨‹åºæ¥è¯´æ˜¯ä¸€ç§æ€§èƒ½ä¸Šçš„æµªè´¹ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œåœ¨2.4.3ä¹‹å‰çš„ç‰ˆæœ¬ä¸­åšäº†äº›ä¼˜åŒ–ã€‚åœ¨BannerPagerAdapterä¸­ç»´æŠ¤ä¸€ä¸ªList<View> mViewListé›†åˆï¼Œç”¨æ¥å­˜æ”¾åˆ›å»ºå‡ºæ¥çš„itemView.åœ¨itemViewåˆå§‹åŒ–æˆåŠŸåï¼Œä¸ºå…¶è®¾ç½®tagå¹¶ä¿å­˜åˆ°é›†åˆä¸­ï¼Œå½“åœ¨æ­¤åˆ‡æ¢é¡µé¢æ—¶æˆ‘ä»¬ä»é›†åˆä¸­å–å‡ºitemViewå¹¶å¯¹æ¯”tag,å¦‚æœä¸€è‡´åˆ™ç›´æ¥ä½¿ç”¨å³å¯ã€‚è¿™æ ·å°±é¿å…äº†é‡å¤çš„åˆ›å»ºå¯¹è±¡ï¼Œé€ æˆä¸€äº›æ€§èƒ½å¼€é”€ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```java
public class BannerPagerAdapter<T, VH extends ViewHolder> extends PagerAdapter {

	private List<View> mViewList = new ArrayList<>();

	private View findViewByPosition(ViewGroup container, int position) {
	        for (View view : mViewList) {
	            if (((int) view.getTag()) == position && view.getParent() == null) {
	                return view;
	            }
	        }
	        View view = getView(position, container);
	        view.setTag(position);
	        mViewList.add(view);
	        return view;
	    }
}
```
ä½†æ˜¯è¿™ä¸€ä¼˜åŒ–å´åˆä¼šå¼•å‘å¦ä¸€ä¸ªé—®é¢˜ï¼Œå³å†…å­˜é—®é¢˜ï¼é€šå¸¸Appçš„è½®æ’­æ§ä»¶éƒ½æ˜¯å›¾ç‰‡ï¼Œè€Œå›¾ç‰‡æ˜¯æ¯”è¾ƒå ç”¨å†…å­˜çš„ã€‚æ­¤æ—¶æˆ‘ä»¬æŠŠæ‰€æœ‰çš„itemViewéƒ½å­˜å‚¨åœ¨ä¸€ä¸ªé›†åˆä¸­è¿™æ ·çœŸçš„æ˜¯ä¸€ä¸ªå¥½çš„æ–¹æ¡ˆå—ï¼Ÿåœ¨ViewPageré¡µé¢å°‘çš„æƒ…å†µä¸‹é—®é¢˜å¯èƒ½ä¸ä¼šå‡¸æ˜¾ã€‚ä½†æ˜¯å¦‚æœViewPagerçš„é¡µé¢å¾ˆå¤šçš„æƒ…å†µä¸‹é—®é¢˜å°±ç›¸å½“ä¸¥é‡äº†ï¼äºæ˜¯ï¼Œåæ¥æˆ‘çµå…‰ä¸€é—ªï¼Œçªå‘å¥‡æƒ³ï¼é‚£æˆ‘å°±è®¾ç½®ä¸€ä¸ªæœ€å¤§ç¼“å­˜å‘—ï¼Ÿå½“é›†åˆä¸­çš„ä¸ªæ•°è¶…è¿‡é˜ˆå€¼çš„æ—¶å€™å°±æŠŠæœ€è¿‘ç”¨è¿‡çš„ä¸€ä¸ªitemViewç§»é™¤æ‰ä¸å°±å¥½äº†ï¼Ÿå¦™å“‰å¦™å“‰ï¼å¯è½¬å¿µä¸€æƒ³ï¼Œè¿™å°¼ç›å’Œè®¾ç½®ä¸€ä¸ªsetOffscreenPageLimitæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿå½“æˆ‘ä»¬åœ¨è€ƒè™‘è¿™äº›é—®é¢˜çš„æ—¶å€™Googleå·¥ç¨‹å¸ˆæ—©å°±æ›¿æˆ‘ä»¬æƒ³åˆ°äº†ï¼æ‰€ä»¥å…³äºViewPagerçš„instantiateItemæ˜¯å¦æœ‰å¿…è¦å»ä¼˜åŒ–æˆ‘ç›®å‰æŒä¿ç•™æ€åº¦ã€‚ä½†æ˜¯ï¼Œåœ¨BannerViewPager 2.4.3ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ç¡®å®åšäº†ä¸Šè¿°ä¼˜åŒ–ï¼Œå› æ­¤å‰äº›ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šå­˜åœ¨å†…å­˜é—®é¢˜ã€‚è‡³äº2.4.3æˆ–ä¹‹åç‰ˆæœ¬å¤§æ¦‚ä¼šå»æ‰è¿™éƒ¨åˆ†ä¼˜åŒ–ã€‚è¿™ä¸ªé—®é¢˜å¯èƒ½ä¹Ÿåªèƒ½ç•™åœ¨æœªæ¥ï¼Œå¾…å‡çº§åˆ°ViewPager2åè§£å†³äº†ï¼å…³äºè¿™ä¸ªé—®é¢˜æ¬¢è¿å¤§å®¶åœ¨æ–‡ç« ä¸‹æ–¹ç•™è¨€ï¼Œå„æŠ’å·±è§ï¼

## 3.RecyclerView+ViewPagerä¼šæœ‰éSmoothçš„é¡µé¢æ»‘åŠ¨æƒ…å†µ

è¿™ä¸ªé—®é¢˜ä¸æ˜¯å¤ªå¥½æè¿°ï¼Œæˆ‘ä»¬ç›´æ¥é€šè¿‡ä¸€å¼ GIFæ¥çœ‹

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS8xMS8xOS8xNmU4NDAyYTEyOWI1MGQ3?x-oss-process=image/format,png)
ä»å›¾ä¸­å¯ä»¥å¾ˆç›´è§‚çš„çœ‹åˆ°ï¼ŒæŠŠBannerViewPagerå‘ä¸Šåˆ’å‡ºå±å¹•å†å¾ˆå¿«åˆ’å›æ¥ï¼Œæ­¤æ—¶BannerViewPageré¡µé¢åˆ‡æ¢çš„åŠ¨ç”»æ²¡æœ‰äº†ï¼Œå¾ˆç”Ÿç¡¬çš„ç›´æ¥è·³åˆ°äº†ä¸‹ä¸€é¡µã€‚è¿™ä¸ªé—®é¢˜ä¸æ˜¯BannerViewPagerçš„bug,è€Œæ˜¯ViewPagerå†…éƒ¨åŸå› å¯¼è‡´çš„ï¼Œå¯ä»¥çœ‹åˆ°å¾ˆå¤šçº¿ä¸Šçš„APPéƒ½å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œä¾‹å¦‚å–œé©¬æ‹‰é›…ï¼ˆå–œé©¬æ‹‰é›…çš„è½®æ’­å›¾çœŸå¿ƒåšçš„å¥½çœ‹å‘€ï¼Œæ•ˆæœä¹Ÿå¾ˆèµï¼ï¼‰ã€‚è¿™ä¸ªbugè™½ç„¶ä¸å½±å“ä½¿ç”¨ï¼Œä½†æ˜¯æ€»æ„Ÿè§‰æ•ˆæœä¸å¤ªå¥½ã€‚å› æ­¤è¿˜æ˜¯è¦å¤„ç†ä¸€ä¸‹ã€‚å¤„ç†ä¹‹å‰å…ˆæ¥åˆ†æä¸€ä¸‹é—®é¢˜åŸå› ã€‚
åœ¨ViewPagerå†…éƒ¨æœ‰ä¸€ä¸ªç§æœ‰æˆå‘˜å˜é‡mFirstLayoutï¼Œå…¶é»˜è®¤å€¼ä¸ºtrueã€‚è¿™ä¸ªå‚æ•°ç”¨æ¥æ ‡è®°æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡layoutçš„ã€‚å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡layouté‚£ä¹ˆæ»‘åŠ¨å°±ä¸æ˜¯smoothçš„ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
    public void setCurrentItem(int item) {
        mPopulatePending = false;
        setCurrentItemInternal(item, !mFirstLayout, false);
    }
    
    void setCurrentItemInternal(int item, boolean smoothScroll, boolean always) {
        setCurrentItemInternal(item, smoothScroll, always, 0);
    }
```
è¿™ä¸ªå‚æ•°åœ¨onLayoutæ–¹æ³•ä¸­ä¼šè¢«ç½®ä¸ºfalse.ä»£ç å¦‚ä¸‹ï¼š
```
    @Override
    protected void onLayout(boolean changed, int l, int t, int r, int b) {
        //  åœ¨onLayoutçš„æœ€åä¸€è¡Œ
        mFirstLayout = false;
    }
```
å› æ­¤ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼ŒonLayoutæ‰§è¡Œä¹‹åé¡µé¢æ»‘åŠ¨éƒ½åº”è¯¥æ—¶smoothçš„ã€‚ç„¶åï¼Œå½“ViewPageræ»‘åŠ¨å‡ºå±å¹•çš„æ—¶å€™å…¶onDetachedFromWindowæ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œè€Œå½“å…¶å†æ¬¡è¿›å…¥å±å¹•çš„æ—¶å€™åˆ™ä¼šè°ƒç”¨onAttachedToWindowè¿™ä¸ªæ–¹æ³•ã€‚æ¥çœ‹çœ‹onAttachedToWindowæ–¹æ³•ä¸­çš„ä»£ç ï¼š
```
@Override
    protected void onAttachedToWindow() {
        super.onAttachedToWindow();
        mFirstLayout = true;
    }
```
ä»…ä»…æŠŠmFirstLayoutç½®ä¸ºäº†trueï¼è€Œå¦‚æœæ­¤æ—¶onLayoutæ²¡æœ‰è¢«è§¦å‘ï¼Œè€Œæ˜¯å…ˆå‘ç”Ÿäº†é¡µé¢æ»šåŠ¨ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„é¡µé¢æ»‘åŠ¨å°±æ²¡äº†çš„smoothæ•ˆæœäº†ã€‚äº†è§£äº†åŸå› ä¹‹åå¤„ç†èµ·æ¥å°±ç®€å•äº†ï¼Œå› ä¸ºmFirstLayoutæ˜¯ç§æœ‰å±æ€§ï¼Œæˆ‘ä»¬æ— æ³•è®¿é—®ï¼Œæ‰€ä»¥åªæœ‰é€šè¿‡åå°„æ¥ä¿®æ”¹å…¶å€¼ã€‚æˆ‘ä»¬åœ¨CatchViewPager(ç»§æ‰¿è‡ªViewPagerçš„ä¸€ä¸ªç±»)ä¸­åšå¦‚ä¸‹æ“ä½œï¼š

```
private boolean firstLayout = true;

 @Override
    protected void onAttachedToWindow() {
        super.onAttachedToWindow();
        hookFirstLayout();
    }


    @Override
    protected void onDetachedFromWindow() {
        super.onDetachedFromWindow();
        firstLayout = false;
    }

 private void hookFirstLayout() {
        try {
            Field mFirstLayout = ViewPager.class.getDeclaredField("mFirstLayout");
            mFirstLayout.setAccessible(true);
            mFirstLayout.set(this, firstLayout);
            setCurrentItem(getCurrentItem());
        } catch (IllegalAccessException | NoSuchFieldException e) {
            e.printStackTrace();
        }
    }

```
è¿™æ ·é—®é¢˜å°±è¿åˆƒè€Œè§£äº†ï¼Œå†æ¬¡æ»‘åŠ¨RecyclerViewï¼Œä¸€åˆ‡å®Œå¥½ï¼
## 4.å…³äºIndicatoråœ¨SMOOTHä¸‹çš„æ»‘åŠ¨é—®é¢˜ã€‚
è¿™æ˜¯ä¸€ä¸ªç”±æ¥å·²ä¹…çš„é—®é¢˜ï¼Œæ„Ÿè§‰å¥½éš¾å¤„ç†ï¼å¦‚æœä¸å¤„ç†å¾ªç¯çš„è¯å…¶å®æ˜¯éå¸¸å®¹æ˜“çš„ï¼Œä½†æ˜¯å¦‚æœåŠ ä¸Šå¾ªç¯ä¹‹åæ€»æ˜¯æœ‰è¿™æ ·é‚£çš„é—®é¢˜ğŸ˜‚ã€‚åªèƒ½è¯´ç›®å‰çš„è®¡ç®—æ–¹å¼ä¸æ˜¯å¤ªå¯¹ï¼Œå…·ä½“æ€ä¹ˆè®¡ç®—çš„æˆ‘ä¹Ÿä¸è´´å‡ºæ¥äº†ï¼æ¯•ç«Ÿç°åœ¨å†™å‡ºæ¥çš„è¿˜æ˜¯æœ‰bugçš„ã€‚å¾ˆç¾¡æ…•å–œé©¬æ‹‰é›…çš„æ»‘åŠ¨æ•ˆæœåšçš„å¤ªNiceäº†ï¼åç»­ç‰ˆæœ¬ä¸­æˆ‘ä¼šæƒ³åŠæ³•å†ä¼˜åŒ–è¿™ä¸ªé—®é¢˜ã€‚

# äº”ã€æ€»ç»“åŠè‡´è°¢
åˆ°è¿™é‡Œå…³äºBannerViewPagerçš„ä¸¤ç¯‡æ–‡ç« å°±å…¨éƒ¨ç»“æŸäº†ï¼Œ[ä¸Šä¸€ç¯‡æ–‡ç« ](https://juejin.im/post/5d6bce24f265da03db0790d1)ä¸»è¦ç€é‡ä»‹ç»äº†BannerViewPagerçš„åŠŸèƒ½åŠç”¨æ³•ï¼Œè€Œæœ¬ç¯‡æ–‡ç« åˆ™è¯¦ç»†çš„è®²è§£äº†BannerViewPagerçš„å®ç°åŸç†ã€‚å°±ç›®å‰è€Œè¨€ï¼ŒBannerViewPagerå¹¶ä¸æ˜¯ä¸€ä¸ªå®Œç¾çš„è½®æ’­åº“ï¼Œå¾ˆå¤šåœ°æ–¹è¿˜æœ‰å¾ˆå¤§å€¼å¾—ä¼˜åŒ–çš„ç©ºé—´ç”šè‡³æœ‰äº›åŠŸèƒ½è¿˜å­˜åœ¨ä¸€äº›å°bugã€‚ä½†æ˜¯è¿™äº›éƒ½ä¸ä¼šé˜»ç¢BannerViewPageré€æ¸èµ°å‘ä¼˜ç§€ã€‚åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­æˆ‘å°†ä¼šé’ˆå¯¹è¿™äº›é—®é¢˜é€ä¸€ä¼˜åŒ–ã€‚å½“ç„¶ï¼Œå¦‚æœä½ æœ‰å¥½çš„è§£å†³æ–¹æ¡ˆæ¬¢è¿åœ¨æ–‡ç« ä¸‹æ–¹ç•™è¨€ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åˆ°githubæäº¤pull requestã€‚å¦‚æœä½ æœ‰ä»€ä¹ˆå¥½çš„å»ºè®®æˆ–è€…é‡åˆ°ä»€ä¹ˆé—®é¢˜ä¹Ÿæ¬¢è¿åœ¨æ–‡ç« ä¸‹æ–¹ç•™è¨€è®¨è®ºã€‚

æœ€åè¦ç‰¹åˆ«æ„Ÿè°¢saiwu-bigkooå¤§ç¥çš„[Android-ConvenientBanner](https://github.com/saiwu-bigkoo/Android-ConvenientBanner)åº“ä»¥åŠyouth5201314å¤§ç¥çš„[banner](https://github.com/youth5201314/banner)åº“ã€‚BannerViewPagerä¸­çš„å¾ˆå¤šæ€æƒ³æ¥è‡ªè¿™ä¸¤ä¸ªåº“ã€‚BannerViewPagerä¸­å†…ç½®çš„å››ä¸ªViewPager Transformæ¥è‡ª[ViewPagerTransforms](https://github.com/ToxicBakery/ViewPagerTransforms)åº“ï¼Œåœ¨æ­¤è¡¨ç¤ºæ„Ÿè°¢ã€‚åŒæ—¶è¿˜è¦æ„Ÿè°¢[ç©Android](https://wanandroid.com/)æä¾›çš„æ¥å£æ”¯æŒï¼Œä»¥åŠåœ¨å¼€å‘è¿‡ç¨‹ä¸­å‚è€ƒè¿‡çš„æ–‡ç« æˆ–å…¶å®ƒä¼˜ç§€å¼€æºåº“ï¼Œä¸èƒ½ä¸€ä¸€åˆ—å‡ºï¼Œåœ¨æ­¤ä¸€å¹¶è¡¨ç¤ºæ„Ÿè°¢ã€‚

æœ€åè¿˜æ˜¯è¦è´´ä¸Šæºç åœ°å€ï¼Œæ¬¢è¿starã€fork ã€‚

[ç‚¹å‡»æŸ¥çœ‹æºç ](https://github.com/zhpanvip/BannerViewPager)